<script>
function converter() {
  let texto = document.getElementById("entrada").value;

  // Normalizar quebras de linha
  texto = texto.replace(/\r\n/g, "\n");

  // üî• Remover blocos desnecess√°rios com regex mais seguro
  texto = texto.replace(/LAN√áADO PELO APLICATIVO[\s\S]*?\n/gi, '');
  texto = texto.replace(/BOPM N¬∫[\s\S]*?\n/gi, '');
  texto = texto.replace(/C√≥digo Inicial:[\s\S]*?registro:[^\n]*\n?/gi, '');
  texto = texto.replace(/Apreens√µes[\s\S]*?Ve√≠culos Envolvidos/gi, '');
  texto = texto.replace(/Endere√ßo[\s\S]*?Guarni√ß√£o\/Policiamento/gi, '');
  texto = texto.replace(/Envolvidos[\s\S]*?Brat/gi, '');
  texto = texto.replace(/Brat[\s\S]*?Condutor:/gi, '');

  // üîç Din√¢mica
  let historico = "---";
  const dinamicaMatch = texto.match(/Declara√ß√£o:\s*([\s\S]*?)(\n|$)/i);
  if (dinamicaMatch) {
    historico = dinamicaMatch[1].trim();
  }

  // üîç Observa√ß√µes
  let observacoes = "---";
  const obsMatch = texto.match(/Condutor:[^\n]*\n([\s\S]*)/i);
  if (obsMatch) {
    observacoes = obsMatch[1].trim();
  }

  const textoY = `SECRETARIA DE ESTADO DE POL√çCIA MILITAR

COMANDO DE POLICIAMENTO RODOVI√ÅRIO (CPRv)

5¬™ CTRv - POSTO PPRv


TERMINO DE OCORR√äNCIA

DATA: 

HORA INICIAL: 
HORA FINAL:  

LOCAL: 


LINK GEORREFERENCIADO:


C√ìD. INICIAL: 

C√ìD. FINAL: 

BOPM: CPRV
RO: 
DP:  
BRAT:
Protocolo: 

QUALIFICADOS:

A1:
CPF: 
CNH:
CAT:
VAL: 
DN: 
BAM: 


VE√çCULO ENVOLVIDO: 

(V1) 
MARCA/MODELO: 
PLACA: 
COR: 
ANO: 

EQUIPE: 

VTR: 

DIN√ÇMICA / HIST√ìRICO:
${historico}

OBSERVA√á√ïES:
${observacoes}
`;

  document.getElementById("saida").value = textoY;
}

function baixarTXT() {
  const texto = document.getElementById("saida").value;
  const blob = new Blob([texto], { type: "text/plain" });
  const link = document.createElement("a");
  const hoje = new Date().toISOString().split("T")[0];
  link.download = `termino_ocorrencia_${hoje}.txt`;
  link.href = URL.createObjectURL(blob);
  link.click();
}
</script>
