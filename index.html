<script>
function converter() {
  let texto = document.getElementById("entrada").value;

  // Normaliza quebras de linha
  texto = texto.replace(/\r\n|\r/g, "\n");

  // Remove blocos que atrapalham
  texto = texto.replace(/LANÇADO PELO APLICATIVO[\s\S]*?(?=\n)/gi, '');
  texto = texto.replace(/BOPM Nº[\s\S]*?(?=\n)/gi, '');
  texto = texto.replace(/Código Inicial:[\s\S]*?registro:[^\n]*\n?/gi, '');
  texto = texto.replace(/Apreensões[\s\S]*?Veículos Envolvidos/gi, '');
  texto = texto.replace(/Endereço[\s\S]*?Guarnição\/Policiamento/gi, '');
  texto = texto.replace(/Envolvidos[\s\S]*?Brat/gi, '');
  texto = texto.replace(/Brat[\s\S]*?Condutor:/gi, '');

  // Extrair DINÂMICA
  let historico = '---';
  let m1 = texto.match(/Declaração:\s*([\s\S]*?)(\n|$)/i);
  if (m1 && m1[1]) {
    historico = m1[1].trim();
  }

  // Extrair OBSERVAÇÕES
  let observacoes = '---';
  let m2 = texto.match(/Condutor:[^\n]*\n([\s\S]*)/i);
  if (m2 && m2[1]) {
    observacoes = m2[1].trim();
  }

  const textoY = `SECRETARIA DE ESTADO DE POLÍCIA MILITAR

COMANDO DE POLICIAMENTO RODOVIÁRIO (CPRv)

5ª CTRv - POSTO PPRv


TERMINO DE OCORRÊNCIA

DATA: 

HORA INICIAL: 
HORA FINAL:  

LOCAL: 


LINK GEORREFERENCIADO:


CÓD. INICIAL: 

CÓD. FINAL: 

BOPM: CPRV
RO: 
DP:  
BRAT:
Protocolo: 

QUALIFICADOS:

A1:
CPF: 
CNH:
CAT:
VAL: 
DN: 
BAM: 


VEÍCULO ENVOLVIDO: 

(V1) 
MARCA/MODELO: 
PLACA: 
COR: 
ANO: 

EQUIPE: 

VTR: 

DINÂMICA / HISTÓRICO:
${historico}

OBSERVAÇÕES:
${observacoes}
`;

  document.getElementById("saida").value = textoY;
}

function baixarTXT() {
  const texto = document.getElementById("saida").value;
  const blob = new Blob([texto], { type: "text/plain" });
  const link = document.createElement("a");
  const hoje = new Date().toISOString().split("T")[0];
  link.download = `termino_ocorrencia_${hoje}.txt`;
  link.href = URL.createObjectURL(blob);
  link.click();
}
</script>
