<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Conversor CPRv</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }

    h2 {
      color: #2c3e50;
    }

    textarea {
      width: 100%;
      height: 250px;
      font-family: monospace;
      font-size: 14px;
      padding: 10px;
      box-sizing: border-box;
      margin-bottom: 15px;
    }

    button {
      padding: 10px 20px;
      background-color: #0077cc;
      color: white;
      border: none;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 20px;
    }

    button:hover {
      background-color: #005fa3;
    }

    .output {
      background: #ffffff;
      border: 1px solid #ccc;
      padding: 15px;
    }

    @media (max-width: 600px) {
      textarea {
        height: 200px;
      }
    }
  </style>
</head>
<body>

  <h2>Conversor BOPM → CPRv</h2>

  <textarea id="entrada" placeholder="Cole aqui o texto bruto do BOPM (Texto X)..."></textarea><br>
  <button onclick="converter()">Converter</button>
  <button onclick="baixarTXT()">Baixar como .txt</button>

  <div class="output">
    <strong>Resultado:</strong><br>
    <textarea id="saida" readonly style="height: 400px;"></textarea>
  </div>

  <script>
    function converter() {
      let texto = document.getElementById("entrada").value;
      texto = texto.replace(/\r\n|\r/g, "\n"); // Normaliza linhas

      // Extrair partes importantes
      let historico = "---";
      let observacoes = "---";

      const m1 = texto.match(/Declaração\s*[:\-–]?\s*([\s\S]*?)(\n|$)/i);
      if (m1 && m1[1]) historico = m1[1].trim();

      const m2 = texto.match(/Condutor[^:\n]*[:\-–]?\s*([\s\S]*?)(\n|$)/i);
      if (m2 && m2[1]) observacoes = m2[1].trim();

      const resultado = `SECRETARIA DE ESTADO DE POLÍCIA MILITAR

COMANDO DE POLICIAMENTO RODOVIÁRIO (CPRv)

5ª CTRv - POSTO PPRv


TERMINO DE OCORRÊNCIA

DATA 

HORA INICIAL 
HORA FINAL  

LOCAL 

LINK GEORREFERENCIADO

CÓD. INICIAL 

CÓD. FINAL 

BOPM CPRV
RO 
DP  
BRAT
Protocolo 

QUALIFICADOS

A1
CPF 
CNH
CAT
VAL 
DN 
BAM 

VEÍCULO ENVOLVIDO 

(V1) 
MARCA/MODELO 
PLACA 
COR 
ANO 

EQUIPE 

VTR 

DINÂMICA / HISTÓRICO:
${historico}

OBSERVAÇÕES:
${observacoes}
`;

      document.getElementById("saida").value = resultado;
    }

    function baixarTXT() {
      const texto = document.getElementById("saida").value;
      const blob = new Blob([texto], { type: "text/plain" });
      const link = document.createElement("a");
      link.download = `termino_ocorrencia_${new Date().toISOString().split("T")[0]}.txt`;
      link.href = URL.createObjectURL(blob);
      link.click();
    }
  </script>

</body>
</html>
